# Etat du Projet - Codex Nag Hammadi BD

**Date:** 11-01-2026 23h00
**Phase:** Application fonctionnelle - Port macOS complet

---

## Resume du Projet

**Objectif:** Creer une BD photorealiste immersive des textes gnostiques de Nag Hammadi en utilisant l'IA generative.

**Vision:**
- Visuel mystique style Denis Villeneuve (Dune, Arrival)
- Narration sacree via Edge TTS (voix neurales gratuites)
- Diaporama automatique images + audio + video

---

## Fonctionnalites Implementees

### Interface Utilisateur
- **MainWindow** : Splitters Liste traites | Texte | Image + Audio
- **TreatiseListWidget** : Navigation par codex (49-52 traites)
- **TextViewerWidget** : Affichage avec numerotation versets [Page:Paragraphe]
- **PassagePreviewWidget** : Selection + boutons generation (Image/Audio/Video)
- **ImageViewerWidget** : Zoom, sauvegarde, grilles de planches (1x1 a 4x4)
- **SlideshowDialog** : Diaporama complet avec controles, voix, plein ecran
- **VideoPreviewDialog** : Lecteur video integre avec fusion audio FFmpeg
- **ApiPricingDockWidget** : Panneau tarifs et selection modeles (F2)
- **SessionPickerDialog** : Selecteur de sessions sauvegardees

### Generation de Contenu
- **PipelineController** : Orchestration Claude/Gemini -> Imagen -> Affichage
- **ClaudeClient** : Analyse passages et generation prompts
- **GeminiClient** : LLM Google (Gemini 2.5/3 Pro)
- **ImagenClient** : Generation images (Imagen 3/4)
- **VeoClient** : Generation videos (Veo 2/3.1) via API Key simple
- **EdgeTTSClient** : Voix neurales Microsoft gratuites (Henri, Denise, Eloise, Remy, Vivienne)
- **ElevenLabsClient** : Voix premium (optionnel)

### Classification Mythique (52 traites)
| Categorie | Traites | Palette |
|-----------|---------|---------|
| Plerome | 7 | Or/blanc/bleu |
| Sophia | 7 | Bleu/argent |
| Demiurge | 7 | Rouge/noir |
| Gnose | 12 | Ocre -> or |
| Ascension | 8 | Or/transparent |
| Liturgie | 3 | Variable |
| Hermetique | 6 | Neutre |
| Narratif | 4 | Terrestre |

### Systeme de Themes
- Themes : Sombre (defaut) et Clair
- Couleur d'accentuation personnalisable
- Polices configurables (interface + texte Codex)
- Persistence dans config.json

### Stockage et Persistence
- **SQLite** : Projets, passages, images, audio
- **MediaStorage** : Sessions avec images/audio sauvegardees
- **SecureStorage** : Cles API securisees (DPAPI Windows / Keychain macOS)
- **Config** : JSON avec APIs, chemins, apparence, session

---

## Port macOS (Session 11-01-2026)

### Corrections Apportees
- **SecureStorage.cpp** : Conditions preprocesseur corrigees pour macOS
- **QFileDialog** : DontUseNativeDialog pour compatibilite macOS
- **TextParser** : Detection alternative des traites par titres (NH X, Y)

### Fichiers Crees pour macOS
- `Run.command` : Script de lancement
- `MediaStorage.h/.cpp` : Gestion sessions et medias
- `SessionPickerDialog.h/.cpp` : Selecteur de session

### Methodes Ajoutees
- `Config` : rememberText, lastText, lastTreatiseCode, lastSelectionStart/End
- `ImageViewerWidget` : gridCols, gridRows, gridImageCount, gridImage, gridText
- `TreatiseListWidget` : selectTreatiseByCode
- `TextViewerWidget` : selectRange
- `TextParser` : parseByTitleHeaders (detection alternative)

---

## Architecture des Fichiers

```
src/
├── api/
│   ├── ApiClient.h/.cpp
│   ├── ClaudeClient.h/.cpp
│   ├── GeminiClient.h/.cpp
│   ├── ImagenClient.h/.cpp
│   ├── VeoClient.h/.cpp
│   ├── EdgeTTSClient.h/.cpp
│   ├── ElevenLabsClient.h/.cpp
│   └── VertexAuthenticator.h/.cpp
├── core/
│   ├── controllers/
│   │   └── PipelineController.h/.cpp
│   ├── entities/
│   │   └── GnosticEntities.h/.cpp
│   └── services/
│       ├── TextParser.h/.cpp
│       ├── PromptBuilder.h/.cpp
│       ├── MythicClassifier.h/.cpp
│       └── NarrationCleaner.h/.cpp
├── db/
│   ├── Database.h/.cpp
│   └── repositories/
│       ├── ProjectRepository.h/.cpp
│       ├── PassageRepository.h/.cpp
│       ├── ImageRepository.h/.cpp
│       └── AudioRepository.h/.cpp
├── ui/
│   ├── MainWindow.h/.cpp
│   ├── widgets/
│   │   ├── TextViewerWidget.h/.cpp
│   │   ├── ImageViewerWidget.h/.cpp
│   │   ├── TreatiseListWidget.h/.cpp
│   │   ├── PassagePreviewWidget.h/.cpp
│   │   ├── AudioPlayerWidget.h/.cpp
│   │   ├── SlideshowWidget.h/.cpp
│   │   ├── InfoDockWidget.h/.cpp
│   │   └── ApiPricingDockWidget.h/.cpp
│   └── dialogs/
│       ├── SettingsDialog.h/.cpp
│       ├── ProjectDialog.h/.cpp
│       ├── SlideshowDialog.h/.cpp
│       ├── SessionPickerDialog.h/.cpp
│       └── VideoPreviewDialog.h/.cpp
└── utils/
    ├── Config.h/.cpp
    ├── Logger.h/.cpp
    ├── SecureStorage.h/.cpp
    ├── ThemeManager.h/.cpp
    ├── MediaStorage.h/.cpp
    ├── ApiPricingManager.h/.cpp
    └── MessageBox.h
```

---

## Fichiers Sources Codex

| Fichier | Traites | Description |
|---------|---------|-------------|
| `codex-nag-hammadi.md` | 52-53 | Complet avec table des matieres structuree |
| `Gnose Nag Hammadi.md` | 44 | Format alternatif (detection par titres) |

---

## Tarifs API (Janvier 2026)

### Videos (Veo)
| Modele | Prix/sec |
|--------|----------|
| Veo 3.1 Fast | $0.15 |
| Veo 3.1 Standard | $0.40 |
| Veo 2 | $0.35 |

### Images (Imagen)
| Modele | Prix/image |
|--------|------------|
| Imagen 3 | $0.03 |
| Imagen 4 Fast | $0.02 |
| Imagen 4 Standard | $0.04 |
| Imagen 4 Ultra | $0.06 |

### Texte (Gemini)
| Modele | Prix/1M tokens |
|--------|----------------|
| Gemini 2.5 Flash-Lite | $0.10 |
| Gemini 2.5 Flash | $0.30 |
| Gemini 3 Pro | $2.00 |

### Budget Mensuel Estime : ~$50

---

## Dependances

### Compilation
- **C++20** avec CMake 3.25+
- **Qt 6.8+** : Core, Widgets, Network, Multimedia, MultimediaWidgets, Sql
- **nlohmann/json** : FetchContent automatique

### Runtime
- **Python 3.x** avec `edge-tts` (pip install edge-tts)
- **FFmpeg** : Pour fusion audio/video (optionnel)

### Plateformes
- **Windows** : MSVC 2022 ou MinGW
- **macOS** : Xcode + Qt6 via MacPorts ou Homebrew

---

## Commandes

### Windows
```batch
build.bat          # Build complet
launch.bat         # Lancer l'app
```

### macOS
```bash
cmake -B build -DCMAKE_PREFIX_PATH=/opt/local/libexec/qt6
cmake --build build --config Release
./Run.command      # Ou double-clic sur Run.command
```

---

## Historique des Sessions

| Date | Description |
|------|-------------|
| 07-01-2026 | Brainstorming BMAD, decisions architecturales |
| 08-01-2026 | Workflow BMM, Product Brief, PRD, Architecture |
| 08-01-2026 | Themes, Edge TTS, UI improvements |
| 09-01-2026 | Diaporama, voix neurales, corrections TTS |
| 10-01-2026 | VeoClient simplifie, VideoPreviewDialog, ApiPricingDock |
| 11-01-2026 | **Port macOS complet**, detection traites alternative |

---

## Prochaines Etapes

### Priorite Haute
1. Tester generation complete sur macOS
2. Verifier integration Imagen/Veo avec cles API

### Priorite Moyenne
3. Ameliorer coherence personnages entre images
4. Export PDF/video du diaporama
5. Generation batch videos pour tous les slides

### Priorite Basse
6. Themes personnalises supplementaires
7. Alertes changements de prix API
8. Cache optimise des images generees

---

*Derniere mise a jour: 11-01-2026 23h00*
